{
  "enabled": true,
  "name": "Gateway Schema Validator",
  "description": "Ensures gateway schemas only use AgentCore-supported JSON Schema properties",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": ["cdk/gateway/schemas/*.json"]
  },
  "then": {
    "type": "askAgent",
    "prompt": "CRITICAL: Fix this Gateway tool schema NOW for AgentCore MCP Gateway compatibility.\n\nAgentCore MCP Gateway ONLY supports these 5 JSON Schema properties:\n- type\n- properties\n- required\n- items\n- description\n\nANY OTHER PROPERTY WILL CAUSE DEPLOYMENT TO FAIL. Remove or convert these:\n- errorSchema → REMOVE the entire errorSchema block (not supported at all)\n- additionalProperties → REMOVE entirely\n- enum → move allowed values into description field\n- format → move format info into description field\n- minimum/maximum → move constraints into description field\n- pattern → move pattern info into description field\n- minLength/maxLength → move into description field\n- minItems/maxItems → move into description field\n- oneOf/anyOf/allOf/not → REMOVE (not supported)\n- const/default/examples → REMOVE\n- title/$ref/$schema → REMOVE\n\nYou MUST fix ALL occurrences in this file.\n\nExample conversions:\n\nBEFORE:\n```json\n{\n  \"name\": \"my_tool\",\n  \"inputSchema\": { ... },\n  \"outputSchema\": { ... },\n  \"errorSchema\": { ... }\n}\n```\n\nAFTER:\n```json\n{\n  \"name\": \"my_tool\",\n  \"inputSchema\": { ... },\n  \"outputSchema\": { ... }\n}\n```\n(errorSchema removed entirely)\n\nBEFORE:\n```json\n\"priority\": {\n  \"type\": \"string\",\n  \"enum\": [\"low\", \"medium\", \"high\"]\n}\n```\n\nAFTER:\n```json\n\"priority\": {\n  \"type\": \"string\",\n  \"description\": \"Priority level. One of: low, medium, high\"\n}\n```\n\nBEFORE:\n```json\n\"email\": {\n  \"type\": \"string\",\n  \"format\": \"email\",\n  \"description\": \"User email\"\n}\n```\n\nAFTER:\n```json\n\"email\": {\n  \"type\": \"string\",\n  \"description\": \"User email (email format)\"\n}\n```\n\nBEFORE:\n```json\n\"inputSchema\": {\n  \"type\": \"object\",\n  \"properties\": { ... },\n  \"required\": [\"id\"],\n  \"additionalProperties\": false\n}\n```\n\nAFTER:\n```json\n\"inputSchema\": {\n  \"type\": \"object\",\n  \"properties\": { ... },\n  \"required\": [\"id\"]\n}\n```\n\nScan the ENTIRE file and fix ALL unsupported properties. The deployment will fail if any remain."
  },
  "shortName": "gateway-schema"
}
