# Spec Requirements: Workflow Input Panel

## Initial Description

Build Demo Viewer input panel with:
1. Multi-line prompt textarea (button submit only, no Enter shortcut)
2. Run Workflow button that spawns `agents/main.py` with `--prompt`, `--workflow-id`, and `--trace-id` CLI args
3. Hybrid identity display showing short `workflow_id` (wf-xxx) with copy button and OTEL `trace_id` with optional X-Ray console link
4. Execution timer
5. Validation states for missing entry script or AWS credentials

Note: The `main.py` is generated by Kiro spec-driven development, not by this extension.

## Requirements Discussion

### First Round Questions

**Q1:** I assume the multi-line textarea should have a reasonable minimum height (3-4 lines visible) with auto-expand as the user types, similar to ChatGPT-style input. Is that correct, or should it be a fixed height with scroll?
**Answer:** Fixed height with scroll (4 lines visible, ~100px). Rationale: Sales demos use prepared prompts that are copy/pasted. Fixed height keeps UI stable and predictable during live demos.

**Q2:** I'm assuming the "Run Workflow" button should be disabled while a workflow is already running (to prevent duplicate spawns), and show a different state like "Running..." with a spinner. Should there also be a "Stop/Cancel" button to kill the subprocess, or is that out of scope for this spec?
**Answer:**
- "Run Workflow" when ready (with play icon)
- "Running..." (disabled) while executing (with hourglass icon)
- Reset button appears after completion/error
- Stop/Cancel is OUT OF SCOPE - subprocess kill has edge cases (orphan processes, partial DynamoDB writes) that warrant separate spec

**Q3:** The spec mentions `wf-xxx` format. I assume this is `wf-` followed by an 8-character UUID segment (like `wf-a1b2c3d4`). Should the copy button copy just the ID (`wf-a1b2c3d4`) or include a prefix like `workflow_id: wf-a1b2c3d4`?
**Answer:** Copy just the bare ID: `wf-a1b2c3d4` (no prefix). For trace_id copy, also just bare hex string: `80e1afed08e019fc1110464cfa66635c`. Users paste into different contexts where prefix would be noise.

**Q4:** For the OTEL trace_id X-Ray link, should it be always visible, conditionally visible based on config, or include a "test connection" validation?
**Answer:**
- Conditionally visible based on `config.observability?.xrayConsoleUrl` setting
- If not set: no link shown
- If set: show link that opens in browser with region and trace_id substituted
- Link appears AFTER workflow starts (when trace_id exists)
- No "test connection" needed

**Q5:** I assume the timer should start when "Run Workflow" is clicked, display elapsed time, stop when workflow completes or fails, and reset when a new workflow starts. Is that correct? Should it also show the final duration after completion?
**Answer:**
- Before first run: Hidden or `--:--`
- Running: `00:04` (updates every 100ms, format `MM:SS`)
- Completed: `00:12.3` (final duration with one decimal)
- Error: `00:08.7` (frozen at failure time)
- New run: Resets to `00:00`
- Final duration persists until next run (for presenter reference)

**Q6:** For missing entry script or AWS credentials validation: Should validation happen proactively (on panel open) or only when clicking "Run Workflow"? What UX for error display?
**Answer:**
- Proactive validation on panel open + on config file changes
- Inline banner above Run button (not modal)
- Three validation types:
  - Entry script not found: `agents/main.py`
  - AWS credentials not configured
  - Project not initialized
- Run button disabled when any validation error exists

**Q7:** Should the prompt text persist when the panel is closed and reopened (stored in workspace state), or always start empty?
**Answer:**
- Persist to workspaceState: `agentify.demoViewer.promptText`, `agentify.demoViewer.lastWorkflowId`
- Do NOT persist: execution state, timer value, events/logs

**Q8:** Is there anything that should explicitly NOT be included in this spec?
**Answer:**
Explicit Out of Scope:
- Stop/Cancel running workflow
- Prompt history/templates
- Keyboard shortcuts (Cmd+Enter)
- Multiple concurrent workflows
- Session/conversation continuity
- Streaming text display in input panel
- Re-run last workflow button

Behaviors to avoid:
- Don't auto-run on panel open
- Don't clear prompt on successful completion
- Don't show trace_id before workflow starts
- Don't poll DynamoDB from input panel
- Don't validate entry script content/syntax (just check file exists)

### Existing Code to Reference

No similar existing features identified for reference.

### Follow-up Questions

No follow-up questions were needed. The initial answers were comprehensive.

## Visual Assets

### Files Provided:

No visual assets provided.

### Visual Insights:

N/A - No visual assets to analyze.

## Requirements Summary

### Functional Requirements

**Prompt Input:**
- Fixed-height multi-line textarea (~100px, 4 lines visible)
- Scroll for overflow content
- Button-only submission (no Enter key shortcut)
- Optimized for copy/paste of prepared demo prompts

**Run Workflow Button:**
- Three visual states:
  - Ready: "Run Workflow" with play icon, enabled
  - Running: "Running..." with hourglass icon, disabled
  - Completed/Error: Reset button appears alongside
- Spawns `agents/main.py` subprocess with CLI arguments:
  - `--prompt`: User's prompt text
  - `--workflow-id`: Generated `wf-{8-char-uuid}` format
  - `--trace-id`: OTEL-compatible 32-character hex string

**Hybrid Identity Display:**
- Workflow ID (`wf-xxxxxxxx`):
  - Displayed prominently
  - Copy button copies bare ID only (no prefix)
- Trace ID (32-char hex):
  - Displayed after workflow starts
  - Copy button copies bare hex string only
  - Optional X-Ray console link (conditionally visible based on `config.observability?.xrayConsoleUrl`)

**Execution Timer:**
- Pre-run: Hidden or displays `--:--`
- Running: `MM:SS` format, updates every 100ms
- Completed: `MM:SS.d` format (one decimal for sub-second precision)
- Error: Frozen at failure time with same format as completed
- Persists final duration until next run starts

**Validation System:**
- Proactive validation on:
  - Panel open
  - Config file changes
- Three validation checks:
  1. Entry script exists (`agents/main.py` or configured path)
  2. AWS credentials configured
  3. Project initialized (`.agentify/config.json` exists)
- Inline error banner above Run button
- Run button disabled when any validation fails

**State Persistence:**
- Persisted to workspaceState:
  - `agentify.demoViewer.promptText`
  - `agentify.demoViewer.lastWorkflowId`
- NOT persisted:
  - Execution state
  - Timer value
  - Events/logs

### Reusability Opportunities

- No existing similar features identified in codebase
- New components to create:
  - Prompt textarea component
  - Run button with state management
  - Identity display with copy buttons
  - Timer component
  - Validation banner component

### Scope Boundaries

**In Scope:**
- Multi-line prompt textarea with fixed height and scroll
- Run Workflow button with ready/running/completed states
- Reset button after workflow completion
- Workflow ID generation and display with copy
- Trace ID generation and display with copy
- Optional X-Ray console link (config-driven)
- Execution timer with multiple display states
- Proactive validation for entry script, AWS credentials, project initialization
- Inline validation error banner
- Workspace state persistence for prompt and last workflow ID

**Out of Scope:**
- Stop/Cancel running workflow functionality
- Prompt history or templates
- Keyboard shortcuts (Cmd+Enter to run)
- Multiple concurrent workflow execution
- Session/conversation continuity between runs
- Streaming text display in input panel
- Re-run last workflow button
- Entry script content/syntax validation (only file existence check)
- DynamoDB polling (handled by other panels)

### Technical Considerations

- Entry script path read from `.agentify/config.json` at `workflow.triggerConfig.entryScript`
- X-Ray URL template from `config.observability?.xrayConsoleUrl` with region and trace_id substitution
- Subprocess spawned with environment variables:
  - `AGENTIFY_TABLE_NAME`
  - `AGENTIFY_TABLE_REGION`
- Timer precision: 100ms update interval during execution
- File existence check only for entry script validation (no parsing)
- VS Code workspace storage API for state persistence

### UI/UX Considerations

- Fixed textarea height maintains stable UI during live demos
- Bare ID copy (no prefix) supports pasting into various contexts
- Final timer value persists for presenter reference during demos
- Proactive validation prevents confusion during demo preparation
- Inline banner (not modal) keeps flow uninterrupted
