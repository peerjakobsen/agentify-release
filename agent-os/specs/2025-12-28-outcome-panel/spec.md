# Specification: Outcome Panel

## Goal
Display workflow execution results in the Demo Viewer, showing success/failure status, rendered output content (markdown or JSON), data sources used, and copy functionality for demo audiences.

## Architecture Context

**This is a demo tool for AWS sales teams.** The workflows execute against **mock integrations**, not real enterprise systems.

When the outcome displays sources like "SAP S/4HANA" or "Salesforce CRM":
- These are **mock tools** that simulate what real integrations would return
- Mock data is generated by Kiro during the ideation phase based on industry context
- No actual connections to enterprise systems are made
- The demo should feel realistic to customers without requiring access to their actual systems

```
Outcome Data Flow
├── Agents (on AgentCore) complete their work
│   └── Call mock tools simulating enterprise systems
│       ├── sap_mock_tool → Fake inventory data
│       ├── salesforce_mock_tool → Fake CRM data
│       └── databricks_mock_tool → Fake forecast data
├── Orchestrator (main.py) emits workflow_complete event
│   └── Includes: result, sources list, execution metrics
└── Outcome Panel renders the result for demo audience
```

## User Stories
- As a demo presenter, I want to see the workflow result clearly displayed so that I can showcase the output to my audience
- As a developer, I want to copy the workflow result to clipboard so that I can use it elsewhere without manual selection

## Specific Requirements

**Outcome Panel Container**
- Replace existing placeholder at lines 877-880 of `demoViewerPanel.ts`
- Panel starts hidden until first `workflow_complete` or `workflow_error` event
- Panel clears immediately when `handleRunWorkflow()` is called, before new outcome arrives
- Position below Execution Log section in the panel hierarchy

**Success State Display**
- Show checkmark icon using `--vscode-testing-iconPassed` color
- Display result content area with appropriate rendering based on content type
- Standard panel border and background styling consistent with log section
- Show "Sources" line when sources array exists and is non-empty

**Error State Display**
- Show X icon using `--vscode-errorForeground` color
- Background: `--vscode-inputValidation-errorBackground`
- Border: `--vscode-inputValidation-errorBorder`
- Error message in `--vscode-foreground` (readable, not alarming red text)
- No stack traces displayed under any circumstances

**Markdown Rendering for String Results**
- Support headers (H1-H6), bold, italic text
- Support bulleted and numbered lists
- Support inline code spans and code blocks
- Support line breaks
- Implement using lightweight regex-based approach (no external library)

**JSON Rendering for Object Results**
- Apply syntax highlighting matching existing log panel patterns
- Always fully expanded (not collapsible tree structure)
- If content exceeds 30 lines, show first 20 lines with "Show full result..." link
- Use same color classes as log panel: `json-string`, `json-number`, `json-boolean`, `json-null`, `json-key`

**Sources Display**
- Show as comma-separated list below result content
- Use muted color: `--vscode-descriptionForeground`
- Only render when sources array exists and has one or more items
- Format: "Sources: SAP S/4HANA, Databricks, Weather API"

**Copy to Clipboard**
- Single copy button for result content
- Standard VS Code button styling with clipboard icon
- Copy raw result (string or stringified JSON)
- Visual feedback on successful copy

**Event Type Extensions**
- Extend `WorkflowCompleteEvent` with optional `result` field (string or object) and `sources` field (string array)
- Add new `WorkflowErrorEvent` type with `error_message` (required) and `error_code` (optional)
- Add type guard `isWorkflowErrorEvent()` following existing pattern in events.ts
- Update `StdoutEvent` union type to include `WorkflowErrorEvent`

**Edge Case Handling**
- Empty result: Display "Workflow completed with no output" message
- Very long result (>100 lines): Truncate with expandable "Show full result..." link
- Non-UTF8/binary data: Display "Result contains binary data" with raw copy option

## Existing Code to Leverage

**`/src/utils/logPanelHtmlGenerator.ts` - tokenizeJson()**
- Lines 93-154 implement JSON syntax highlighting with token parsing
- Returns HTML with span elements for each token type (string, number, boolean, null, key)
- Reuse directly for rendering object results with syntax highlighting

**`/src/utils/logPanelHtmlGenerator.ts` - escapeHtml()**
- Lines 28-35 provide HTML special character escaping
- Reuse for all user-generated content rendering in the outcome panel

**`/src/types/logPanel.ts` - LogPanelState Pattern**
- Lines 109-134 define state interface with entries, filters, isCollapsed, and scroll state
- Follow same pattern for `OutcomePanelState` interface with status, result, sources, visibility

**`/src/utils/logPanelHtmlGenerator.ts` - CSS Custom Properties**
- Lines 320-639 define semantic color variables for VS Code theming
- Reuse `--log-color-success`, `--log-color-error`, JSON syntax highlighting classes
- Follow same CSS architecture for outcome panel styles

**`/src/types/events.ts` - Event Type Structure**
- Lines 121-130 define WorkflowCompleteEvent structure to extend
- Lines 225-258 show type guard patterns to follow for new event types

## Out of Scope
- Partial results on workflow error (only error message displayed)
- Stack trace display in error states
- Retry button or retry functionality
- Result history or comparison between runs
- Export result to file functionality
- Result validation or formatting options UI
- Animated transitions or animations
- Loading/pending state indicator before result arrives
- Click-to-scroll integration with Execution Log entries
- External markdown rendering library dependencies (must use regex-based approach)
